<!-- Loading Indicator -->
{{ block "indicator" . }}
<img id="indicator" src="svg/bars.svg" class="absolute top-1/4 self-center inline htmx-indicator right-8">
{{end}}

<!-- Search Page -->
{{ block "results-init" . }}
<div class="grid place-items-center relative">
    <img src="images/Banner.jpeg" class="col-start-1 row-start-1 object-cover top-0 z-1 w-full h-auto max-w-full">
    <div id="formwrapper" class="col-start-1 row-start-1 z-2 pl-2 grid place-items-center">
        <form hx-post="/search" hx-target="#results-container" hx-swap="innerHTML" hx-trigger="load, submit" class="w-full max-w-2xl">
            <div id="searchbar" class="relative">
                <input 
				id="searchquery"
				autocomplete="off"
				class="w-full px-6 py-3 text-2xl border-2 border-blue-500 rounded-full shadow-md focus:ring-2 focus:ring-blue-400 focus:outline-none transition-all duration-200"
				type="text" 
				name="query"
                hx-post="/search/suggestions"
                hx-trigger="input changed delay:250ms"
                hx-target="#suggestions"
                hx-swap="innerHTML"
				value="{{ . }}">
                {{ template "indicator" . }}
                <div id="suggestions" class="absolute z-10 w-full top-full left-0 bg-white border border-gray-300 shadow-lg hidden"></div>
            </div>
			<script>
				document.addEventListener('htmx:afterSwap', function(event) {
					console.log(event.detail.elt)
					if (event.detail.elt.id === "suggestions") {
						if (event.detail.elt.childNodes.length > 0) {
							console.log("g0")
							document.getElementById('suggestions').classList.remove('hidden');
						} else {
							console.log("e0")
							document.getElementById('suggestions').classList.add('hidden');
						}
					}
				})
				document.addEventListener('click', (event) => {
					const input = document.querySelector('#searchbar input');
					const dropdown = document.getElementById('suggestions');

					if (event.target === input) {
						const dropdownElementsCount = dropdown.querySelectorAll('p').length;
						if (dropdownElementsCount > 0) {
							dropdown.classList.remove('hidden');
						} else {
							dropdown.classList.add('hidden');
						}
					}

					if (!input.contains(event.target) && !dropdown.contains(event.target)) {
						dropdown.classList.add('hidden');
					}
				});
			</script>
        </form>
    </div>
    <div id="results-container" class="min-h-screen px-4">
    </div>
</div>
{{end}}
